(this["webpackJsonpreact-leaflet-map"]=this["webpackJsonpreact-leaflet-map"]||[]).push([[0],{17:function(e,t,n){},29:function(e,t,n){},31:function(e,t,n){},32:function(e,t,n){},33:function(e,t,n){"use strict";n.r(t);var a=n(1),c=n(18),r=n(2),i=(n(29),n.p+"static/media/logo-light.b2db820f.svg"),o=n(0);function s(){return Object(o.jsx)("h1",{className:"logo",children:Object(o.jsx)("a",{target:"_blank",rel:"noreferrer",href:"https://reiracode.github.io/react-leaflet-map",children:Object(o.jsx)("img",{src:i,alt:"Bikeland"})})})}var l=function(e){return Object(o.jsx)("header",{children:Object(o.jsx)("div",{className:"header_wrapper",children:Object(o.jsx)(s,{})})})},p=n(4),u=n(7),b=(n(31),function(){return new Promise((function(e){if(navigator.geolocation){navigator.geolocation.getCurrentPosition((function(t){e([t.coords.latitude,t.coords.longitude])}),(function(t){switch(t.code){case t.PERMISSION_DENIED:case t.POSITION_UNAVAILABLE:alert("\u8b80\u53d6\u4e0d\u5230\u60a8\u76ee\u524d\u7684\u4f4d\u7f6e");break;case t.TIMEOUT:alert("\u8b80\u53d6\u4f4d\u7f6e\u903e\u6642");break;case t.UNKNOWN_ERROR:alert("Error")}e([35.4122,139.413])}))}}))});function d(e){return j.apply(this,arguments)}function j(){return(j=Object(u.a)(Object(p.a)().mark((function e(t){var n,a,c,i,o,s,l,u,b,d,j,g,f,O;return Object(p.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(console.log(t),0!=t.length){e.next=4;break}return console.log("0"),e.abrupt("return");case 4:return e.prev=4,n=Object(r.a)(t,2),a=n[0],c=n[1],i="https://tdx.transportdata.tw/api/advanced/v2/Bike/Station/NearBy?%24top=30&%24spatialFilter=nearby(".concat(a,",").concat(c,",1000)&%24format=JSON"),o="https://tdx.transportdata.tw/api/advanced/v2/Bike/Availability/NearBy?%24top=30&%24spatialFilter=nearby(".concat(a,",").concat(c,",1000)&%24format=JSON"),e.next=10,Promise.allSettled([h(i),h(o)]);case 10:for(s=e.sent,l=[],u=[s[0].value,s[1].value],d=u[1],j=(b=u[0]).map((function(e){return e.StationUID})),g=d.filter((function(e){return j.indexOf(e.StationUID)>-1})),f=0;f<b.length;f++)O={stationId:b[f].StationUID,stationName:b[f].StationName.Zh_tw,stationAddress:b[f].StationAddress.Zh_tw,stationPosition:{lat:b[f].StationPosition.PositionLat,lng:b[f].StationPosition.PositionLon},serviceStatus:g[f].ServiceStatus,availableRentBikes:g[f].AvailableRentBikes,availableReturnBikes:g[f].AvailableReturnBikes,srcUpdateTime:g[f].SrcUpdateTime},l.push(O);return e.abrupt("return",l);case 19:throw e.prev=19,e.t0=e.catch(4),e.t0;case 22:case"end":return e.stop()}}),e,null,[[4,19]])})))).apply(this,arguments)}function h(e){return g.apply(this,arguments)}function g(){return(g=Object(u.a)(Object(p.a)().mark((function e(t){var n,a,c;return Object(p.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,f();case 2:return n=e.sent,e.prev=3,e.next=6,fetch(t,{headers:{authorization:"Bearer ".concat(n.access_token)}});case 6:return a=e.sent,e.next=9,a.json();case 9:return c=e.sent,e.abrupt("return",c);case 13:throw e.prev=13,e.t0=e.catch(3),e.t0;case 16:case"end":return e.stop()}}),e,null,[[3,13]])})))).apply(this,arguments)}function f(){return O.apply(this,arguments)}function O(){return(O=Object(u.a)(Object(p.a)().mark((function e(){var t,n;return Object(p.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return"https://tdx.transportdata.tw/auth/realms/TDXConnect/protocol/openid-connect/token",t=new URLSearchParams({grant_type:"client_credentials",client_id:"reira.igg-178246c9-c6da-466e",client_secret:"9f16dc51-0a6e-492c-9dd6-278b917d0c67"}).toString(),e.next=5,fetch("https://tdx.transportdata.tw/auth/realms/TDXConnect/protocol/openid-connect/token",{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:t});case 5:return n=e.sent,e.next=8,n.json();case 8:return e.abrupt("return",e.sent);case 9:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var m=n.p+"static/media/icon-user-position-mobile.4af8babd.svg",x=n.p+"static/media/icon-geolocation.7783d3dc.svg",y=n.p+"static/media/icon-bicycle.39345ce0.svg",v=n.p+"static/media/icon-bicycle-grey.7b8cb6aa.svg",k=n.p+"static/media/icon-bicycle-white.0cdc8c9e.svg",w=n.p+"static/media/icon-parking.d41d0ee4.svg",N=n.p+"static/media/icon-parking-grey.84ff3ab7.svg",S=n.p+"static/media/icon-parking-white.95eab66a.svg",_=n(34),B=n(35);var P=n(3);n(32),n(13);var R=n(20),I=n(21),U=(n(8),n(39)),C=n(36),E=n(37),T=n(38),A=(n(17),function(e){return Object(_.a)().setView(e.center),null}),D=n.p+"static/media/icon-bike-marker-grey.d4557c2f.svg",F=n.p+"static/media/icon-bike-marker-blue.74f2085e.svg",M=n.p+"static/media/icon-bike-marker-purple.3b18ae3f.svg",z=new P.Icon({iconUrl:m,iconSize:[32,32]});function J(e){return new P.Icon({iconUrl:e,iconSize:[41,47]})}function q(e){return J(0===e?D:e<=5?F:M)}function Z(){var e=Object(a.useState)(null),t=Object(r.a)(e,2),n=t[0],c=t[1],i=Object(a.useState)(null),s=Object(r.a)(i,2),l=s[0],j=s[1],h=Object(a.useState)([]),g=Object(r.a)(h,2),f=g[0],O=g[1],m=Object(a.useState)(!0),P=Object(r.a)(m,2),R=P[0],I=P[1],D=Object(a.useState)(!1),L=Object(r.a)(D,2),F=L[0],M=(L[1],Object(a.useState)(!0)),J=Object(r.a)(M,2),Z=J[0],V=J[1],W=Object(o.jsx)("div",{className:"overlay",children:Object(o.jsx)("span",{className:"typography-bold typography-h4",children:"\u5b9a\u4f4d\u4e2d"})});function X(){V(!Z)}var K=Object(a.useCallback)(Object(u.a)(Object(p.a)().mark((function e(){var t,n;return Object(p.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,b();case 2:return t=e.sent,console.log("--------yourlocation"+t),c(t),e.next=7,d(t);case 7:n=e.sent,O(n),console.log(n),I(!1);case 11:case"end":return e.stop()}}),e)}))),[]),Y=Object(o.jsx)(o.Fragment,{children:Object(o.jsx)("button",{className:"geolocation",disabled:!!R,onClick:K,children:Object(o.jsx)("img",{src:x,alt:"geolocation icon"})})});function G(){return(G=Object(u.a)(Object(p.a)().mark((function e(){var t;return Object(p.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(console.log(" getdragPosition"),console.log(l),console.log(F),null!==l){e.next=7;break}return e.abrupt("return");case 7:return e.next=9,d(l);case 9:t=e.sent,O(t),console.log(t);case 12:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function H(){Object(_.b)({dragend:function(e){console.log("mapCenter",e.target.getCenter());var t=e.target.getCenter(),n=[t.lat,t.lng];j(n),c(n)}});return Object(o.jsx)(o.Fragment,{children:Object(o.jsx)(C.a,{position:n,icon:z,children:Object(o.jsx)(E.a,{children:"You are here"})})})}function Q(){if(0!=f.length)return f.map((function(e,t){var n=/.*T(\d*:\d*)/g.exec(e.srcUpdateTime)[1];return Object(o.jsxs)(C.a,{icon:q(Z?e.availableRentBikes:e.availableReturnBikes),position:[e.stationPosition.lat,e.stationPosition.lng],children:[Object(o.jsx)(E.a,{className:"request-popup",children:Object(o.jsxs)("div",{className:"bikeMarkers_popup",children:[Object(o.jsx)("h3",{className:"typography-bold typography-button",children:e.stationName}),Object(o.jsxs)("div",{className:"popup_info",children:[Object(o.jsxs)("div",{className:"popup_bikes ",children:[Object(o.jsx)("img",{src:v,alt:"bicycle icon"}),Object(o.jsx)("span",{className:"quantity typography-bold typography-button",children:e.availableRentBikes})]}),Object(o.jsxs)("div",{className:"popup_parks",children:[Object(o.jsx)("img",{src:N,alt:"bicycle icon"}),Object(o.jsx)("span",{className:"quantity typography-bold typography-button",children:e.availableReturnBikes})]}),Object(o.jsxs)("span",{className:"update_time typography-medium typography-caption",children:[n,"\u66f4\u65b0"]})]})]})}),Object(o.jsx)(T.a,{direction:"center",offset:[0,-2],opacity:1,permanent:!0,children:Z?e.availableRentBikes:e.availableReturnBikes})]},t)}))}return Object(a.useEffect)((function(){K(),console.log("getPosition in useEffect")}),[K]),Object(a.useEffect)((function(){console.log(R),l&&(console.log("getdragPosition in useEffect"+l),function(){G.apply(this,arguments)}(l))}),[l]),Object(a.useEffect)((function(){console.log(Z)}),[Z]),Object(o.jsxs)("main",{children:[R?W:null,n?Object(o.jsxs)(B.a,{center:n,zoom:16,scrollWheelZoom:!0,style:{height:"calc(100vh - 40px)"},children:[Object(o.jsx)(A,{center:n}),Object(o.jsx)(U.a,{attribution:'\xa9 <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors',url:"https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png"}),Object(o.jsx)(H,{}),Object(o.jsx)(Q,{}),Object(o.jsxs)("div",{className:"find_type_wrapper",children:[Object(o.jsxs)("label",{htmlFor:"find_bikes",children:[Object(o.jsx)("input",{type:"radio",name:"find_type",id:"find_bikes",checked:Z,onChange:function(){},hidden:!0}),Object(o.jsxs)("button",{className:"find_type typography-bold typography-button",onClick:X,children:[Object(o.jsx)("div",{className:"find_type_img",children:Z?Object(o.jsx)("img",{src:k,alt:"bicycle white icon"}):Object(o.jsx)("img",{src:y,alt:"bicycle white icon"})}),"\u627e\u55ae\u8eca"]})]}),Object(o.jsxs)("label",{htmlFor:"find_parks",children:[Object(o.jsx)("input",{type:"radio",name:"find_type",id:"find_parks",checked:!Z,onChange:function(){},hidden:!0}),Object(o.jsxs)("button",{className:"find_type typography-bold typography-button",onClick:X,children:[Object(o.jsx)("div",{className:"find_type_img",children:Z?Object(o.jsx)("img",{src:w,alt:"parking icon"}):Object(o.jsx)("img",{src:S,alt:"parking icon"})}),"\u627e\u8eca\u4f4d"]})]})]}),Y]}):null]})}function V(){var e=Object(a.useState)({latitude:35.6803997,longitude:139.7690174,capital:"Tokyo"}),t=Object(r.a)(e,2),n=(t[0],t[1],L.icon({iconUrl:R.a,shadowUrl:I.a}));L.Marker.prototype.options.icon=n;return Object(o.jsxs)("div",{className:"App",children:[Object(o.jsx)(l,{}),Object(o.jsx)(Z,{})]})}var W=document.getElementById("root");Object(c.createRoot)(W).render(Object(o.jsx)(a.StrictMode,{children:Object(o.jsx)(V,{})}))}},[[33,1,2]]]);
//# sourceMappingURL=main.fba5fae7.chunk.js.map