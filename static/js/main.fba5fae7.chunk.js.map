{"version":3,"sources":["assets/logo-light.svg","layout/header.js","utils/getGeolocation.js","utils/fetchTdxApi.js","assets/icon-user-position-mobile.svg","assets/icon-geolocation.svg","assets/icon-bicycle.svg","assets/icon-bicycle-grey.svg","assets/icon-bicycle-white.svg","assets/icon-parking.svg","assets/icon-parking-grey.svg","assets/icon-parking-white.svg","layout/main.js","components/ChangeCenter.js","assets/icon-bike-marker-grey.svg","assets/icon-bike-marker-blue.svg","assets/icon-bike-marker-purple.svg","components/MapTest.js","App.js","index.js"],"names":["Logo","className","target","rel","href","src","logoSvg","alt","Header","props","asyncGetGeolocation","Promise","resolve","navigator","geolocation","getCurrentPosition","position","coords","latitude","longitude","error","code","PERMISSION_DENIED","POSITION_UNAVAILABLE","alert","TIMEOUT","UNKNOWN_ERROR","getAvailableBikes","userPosition","console","log","length","lat","lng","stationUrl","bikeUrl","allSettled","fetchTdxApi","data","result","value","bikeData","stationIndex","stationData","map","item","StationUID","bikeDetail","filter","indexOf","i","stationStatus","stationId","stationName","StationName","Zh_tw","stationAddress","StationAddress","stationPosition","StationPosition","PositionLat","PositionLon","serviceStatus","ServiceStatus","availableRentBikes","AvailableRentBikes","availableReturnBikes","AvailableReturnBikes","srcUpdateTime","SrcUpdateTime","push","url","getToken","tokenCode","fetch","headers","authorization","access_token","response","json","queryString","URLSearchParams","grant_type","client_id","client_secret","toString","method","body","Main","ChangeCenter","useMap","setView","center","myIcon","Icon","iconUrl","marker","iconSize","createIcon","name","availabilityNum","options","bikemarker0","bikemarker1","bikemarker2","MapTest","useState","setUserPosition","dragposi","setDragposi","getdata","setGetdata","isLocatingUser","setIsLocatingUser","isDrag","isFindingBikes","setIsFindingBikes","locatingMessage","handleFindingType","getPosition","useCallback","urlocation","bikes","getLocationButton","disabled","onClick","geolocactionSvg","MyComponent","useMapEvents","dragend","e","getCenter","newposition","data1","Marker","icon","Popup","MultipleMarkers","station","index","updateTime","exec","bicycleGreySvg","parkingGreySvg","Tooltip","direction","offset","opacity","permanent","useEffect","getdragPosition","MapContainer","zoom","scrollWheelZoom","style","height","TileLayer","attribution","htmlFor","type","id","checked","onChange","hidden","bicycleWhiteSvg","bicycleSvg","parkingSvg","parkingWhiteSvg","App","capital","DefaultIcon","L","shadowUrl","iconShadow","prototype","rootElement","document","getElementById","createRoot","render"],"mappings":"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","file":"static/js/main.fba5fae7.chunk.js","sourcesContent":["export default __webpack_public_path__ + \"static/media/logo-light.b2db820f.svg\";","import { useState } from \"react\";\nimport \"./header.css\";\nimport logoSvg from \"../assets/logo-light.svg\";\n\n\nfunction Logo() {\n  return (\n    <h1 className=\"logo\">\n      <a\n        target=\"_blank\"\n        rel=\"noreferrer\"\n        href=\"https://reiracode.github.io/react-leaflet-map\"\n      >\n        <img src={logoSvg} alt=\"Bikeland\" />\n      </a>\n    </h1>\n  );\n}\n\n\n\nfunction Header(props) {\n\n\n  return (\n    <header>\n      <div className=\"header_wrapper\">\n        <Logo />\n        \n      </div>\n   \n    </header>\n  );\n}\n\nexport default Header;\n","// const asyncGetGeolocation = (\n//   options = { enableHighAccuracy: true, timeout: 5000, maximumAge: 0 }\n// ) => {\n//   return new Promise((resolve, reject) => {\n//     function onResolve(data) {\n//       resolve([data.coords.latitude, data.coords.longitude]);\n//     }\n//     function onReject(error) {\n//       reject(error);\n//     }\n//     navigator.geolocation.getCurrentPosition(onResolve, onReject, options);\n//   });\n// };\n\nconst asyncGetGeolocation = () => {\n  return new Promise((resolve) => {\n    if (navigator.geolocation) {\n      const position = (position) => {\n        resolve([position.coords.latitude, position.coords.longitude]);\n      };\n      const showError = (error) => {\n        switch (error.code) {\n          case error.PERMISSION_DENIED:\n            alert(\"讀取不到您目前的位置\");\n            break;\n          case error.POSITION_UNAVAILABLE:\n            alert(\"讀取不到您目前的位置\");\n            break;\n          case error.TIMEOUT:\n            alert(\"讀取位置逾時\");\n            break;\n          case error.UNKNOWN_ERROR:\n            alert(\"Error\");\n            break;\n        }\n        resolve([35.4122, 139.4130]);\n      };\n      navigator.geolocation.getCurrentPosition(position, showError);\n    }\n  });\n};\n\nexport default asyncGetGeolocation;\n","// import jsSHA from \"jssha/dist/sha1\";\n// https://tdx.transportdata.tw/api-service/swagger#/Bike%20Advanced(Nearby)/BikeApi_Station_AllCity_NearBy_2870\n\nexport async function getAvailableBikes(userPosition) {\n  console.log(userPosition)\n\n  if (userPosition.length == 0){\n    console.log(\"0\")\n    return;\n  }\n\n  //前後端的関係：如果api 後端没有處理好，advanced的功能就會在前端，json資料的比對，計算距離\n  //口罩地圖和ubike的不同。\n  //不用token的話：放上github 就用basic 搭配indexOf > -1\n  try {\n    const [lat, lng] = userPosition;\n    // const stationUrl = `https://tdx.transportdata.tw/api/basic/v2/Bike/Station/City/Taipei?&%24format=JSON`;\n    // const bikeUrl = `https://tdx.transportdata.tw/api/basic/v2/Bike/Availability/City/Taipei?%24format=JSON`;\n\n    // const stationUrl = `https://tdx.transportdata.tw/api/basic/v2/Bike/Station/City/Taipei?%24top=30&%24spatialFilter=nearby(${lat},${lng},1000)&%24format=JSON`;\n    // const bikeUrl = `https://tdx.transportdata.tw/api/basic/v2/Bike/Availability/City/Taipei?%24format=JSON`;\n\n    const stationUrl = `https://tdx.transportdata.tw/api/advanced/v2/Bike/Station/NearBy?%24top=30&%24spatialFilter=nearby(${lat},${lng},1000)&%24format=JSON`;\n    const bikeUrl = `https://tdx.transportdata.tw/api/advanced/v2/Bike/Availability/NearBy?%24top=30&%24spatialFilter=nearby(${lat},${lng},1000)&%24format=JSON`;\n\n    const data = await Promise.allSettled([\n      fetchTdxApi(stationUrl),\n      fetchTdxApi(bikeUrl),\n    ]);\n\n    const result = [];\n    const [stationData, bikeData] = [data[0].value, data[1].value];\n\n    const stationIndex = stationData.map(item => item.StationUID);\n    // console.log(stationIndex)\n\n    const bikeDetail = bikeData.filter((item) => stationIndex.indexOf(item.StationUID) > -1)\n    // console.log(bikeDetail)\n\n    ////////////////////\n    for (let i = 0; i < stationData.length; i++) {\n      let stationStatus = {\n        stationId: stationData[i].StationUID,\n        stationName: stationData[i].StationName.Zh_tw,\n        stationAddress: stationData[i].StationAddress.Zh_tw,\n        stationPosition: {\n          lat: stationData[i].StationPosition.PositionLat,\n          lng: stationData[i].StationPosition.PositionLon,\n        },\n        serviceStatus: bikeDetail[i].ServiceStatus,\n        availableRentBikes: bikeDetail[i].AvailableRentBikes,\n        availableReturnBikes: bikeDetail[i].AvailableReturnBikes,\n        srcUpdateTime: bikeDetail[i].SrcUpdateTime,\n      };\n      result.push(stationStatus);\n    }\n    // console.log(result) ;\n    return result;\n\n\n  } catch (error) {\n    throw error;\n  }\n}\n\nexport default async function fetchTdxApi(url) {\n  const tokenCode = await getToken();\n  try {\n    const response = await fetch(url, { headers: { authorization: `Bearer ${tokenCode.access_token}` } });\n    \n    // const response = await fetch(url);\n    const data = await response.json();\n    return data;\n  } catch (error) {\n    throw error;\n  }\n}\n\nasync function getToken() {\n  const parameter = {\n    grant_type: \"client_credentials\",\n    client_id: \"reira.igg-178246c9-c6da-466e\",\n    client_secret: \"9f16dc51-0a6e-492c-9dd6-278b917d0c67\"\n  };\n  let auth_url = \"https://tdx.transportdata.tw/auth/realms/TDXConnect/protocol/openid-connect/token\";\n  const queryString = new URLSearchParams(parameter).toString();\n\n  let response = await fetch(auth_url, {\n    method: 'POST',\n    headers: { 'Content-Type': 'application/x-www-form-urlencoded' },\n    body: (queryString)\n  });\n\n  // you can check for response.ok here, and literally just throw an error if you want\n  return await response.json();\n}\n","export default __webpack_public_path__ + \"static/media/icon-user-position-mobile.4af8babd.svg\";","export default __webpack_public_path__ + \"static/media/icon-geolocation.7783d3dc.svg\";","export default __webpack_public_path__ + \"static/media/icon-bicycle.39345ce0.svg\";","export default __webpack_public_path__ + \"static/media/icon-bicycle-grey.7b8cb6aa.svg\";","export default __webpack_public_path__ + \"static/media/icon-bicycle-white.0cdc8c9e.svg\";","export default __webpack_public_path__ + \"static/media/icon-parking.d41d0ee4.svg\";","export default __webpack_public_path__ + \"static/media/icon-parking-grey.84ff3ab7.svg\";","export default __webpack_public_path__ + \"static/media/icon-parking-white.95eab66a.svg\";","import \"./main.css\";\nimport { useState, useEffect, useCallback } from \"react\";\nimport asyncGetGeolocation from \"../utils/getGeolocation\";\nimport { getAvailableBikes } from \"../utils/fetchTdxApi\";\nimport BikeMap from \"../components/bikeMap\";\n// import BikeMap from \"../components/bikeMap3\";\n\nfunction Main() {\n\n\n\n  function handleFindingType() {\n    setIsFindingBikes((bool) => !bool);\n  }\n\n  const TAIPEI_COORDINATES = [35.4122, 139.4130];\n  const [userPosition, setUserPosition] = useState(TAIPEI_COORDINATES);\n  // const [userPosition, setUserPosition] = useState(false);\n\n  const [bikesAvailable, setBikesAvailable] = useState([]);\n  // const [isLocatingUser, setIsLocatingUser] = useState(false);\n  const [isLocatingUser, setIsLocatingUser] = useState(true);\n  const [isFindingBikes, setIsFindingBikes] = useState(true);\n \n  ///方式1   OK   try catch ////////////\n  // const getLocation = async () => {\n  //   try {\n  //     const userCoordinates = await asyncGetGeolocation();\n  //     console.log(\"default定位成功\" + userCoordinates)\n  //     setUserPosition(userCoordinates);\n  //     const bikes = await getAvailableBikes(userCoordinates);\n  //     console.log(bikes)\n  //     setBikesAvailable(bikes);\n  //     setIsLocatingUser(false);\n  //   } catch (error) {\n  //     throw error;\n  //   }\n  // };\n\n  // useEffect(() => {\n  //   getLocation();\n  // }, []);\n\n\n  // 方式3 -------  用 useCallback 並將回傳的函式取名為 fetchData\n  // const fetchData = useCallback(() => {\n  // //   // STEP 3：把原本的 fetchData 改名為 fetchingData 放到 useCallback 的函式內\n  //   const fetchingData = async () => {\n  //     const data1 = await asyncGetGeolocation();\n  //     setUserPosition(data1);\n  //     const bikes = await getAvailableBikes(data1);\n  //     setBikesAvailable(bikes);\n  //     setIsLocatingUser(false);\n  //   };\n  //   fetchingData();\n  // }, []);\n\n  // useEffect(() => {\n  //   console.log('execute function in useEffect');\n  //   fetchData();\n  //   // STEP 6：把透過 useCallback 回傳的函式放到 useEffect 的 dependencies 中\n  // }, [fetchData]);\n\n\n  //  方式4  -------   OK callback //   //   //   //\n  // async function getPosts() {\n  //   const data = await asyncGetGeolocation();\n  //   console.log(data);\n  //   return data;\n  // }\n\n  const getPosition = useCallback(async () => {\n    const data = await asyncGetGeolocation();\n    console.log(\"yourlocation\" + data)\n    setUserPosition(data);\n\n    const bikes = await getAvailableBikes(data);\n    setBikesAvailable(bikes);\n    setIsLocatingUser(false);\n  }, [])\n\n  useEffect(() => {\n    console.log('execute getPosition in useEffect');\n    getPosition()\n  }, [getPosition]);\n\n \n    //   //   //   //   //   //   //   // \n  const locatingMessage = (\n    <div className=\"overlay\">\n      <span className=\"typography-bold typography-h4\">定位中</span>\n    </div>\n  );\n\n  return (\n    <main>\n      {/* {locatingMessage} */}\n      {isLocatingUser ? locatingMessage : null}\n      {userPosition &&\n        <BikeMap\n          userPosition={userPosition}\n          bikesAvailable={bikesAvailable}\n          isFindingBikes={isFindingBikes}\n          handleLocateUser={getPosition}\n          isLocatingUser={isLocatingUser}\n          handleFindingType={handleFindingType}\n        />\n      }\n  \n \n    </main>\n  );\n}\n\nexport default Main;\n","import { useMap, useMapEvents } from \"react-leaflet\";\n\nconst ChangeCenter = (props) => {\n  const map = useMap();\n  map.setView(props.center);\n  return null;\n};\n\n \n\n\nexport { ChangeCenter };\n\n\n","export default __webpack_public_path__ + \"static/media/icon-bike-marker-grey.d4557c2f.svg\";","export default __webpack_public_path__ + \"static/media/icon-bike-marker-blue.74f2085e.svg\";","export default __webpack_public_path__ + \"static/media/icon-bike-marker-purple.3b18ae3f.svg\";","import React, { useState, useCallback, useEffect } from \"react\";\nimport { MapContainer, TileLayer, useMapEvents, Marker, Popup, Tooltip } from \"react-leaflet\";\nimport asyncGetGeolocation from \"../utils/getGeolocation\";\nimport { getAvailableBikes } from \"../utils/fetchTdxApi\";\n\nimport \"leaflet/dist/leaflet.css\";\nimport \"../index.css\";\n\nimport geolocactionSvg from \"../assets/icon-geolocation.svg\";\nimport marker from '../assets/icon-user-position-mobile.svg';\n// import ChangeCenter from \"./ChangeCenter\";\nimport { ChangeCenter } from \"./ChangeCenter\";\nimport bikemarker0 from \"../assets/icon-bike-marker-grey.svg\";\nimport bikemarker1 from '../assets/icon-bike-marker-blue.svg';\nimport bikemarker2 from \"../assets/icon-bike-marker-purple.svg\";\nimport bicycleSvg from \"../assets/icon-bicycle.svg\";\nimport parkingSvg from \"../assets/icon-parking.svg\";\nimport bicycleGreySvg from \"../assets/icon-bicycle-grey.svg\";\nimport bicycleWhiteSvg from \"../assets/icon-bicycle-white.svg\";\nimport parkingGreySvg from \"../assets/icon-parking-grey.svg\";\nimport parkingWhiteSvg from \"../assets/icon-parking-white.svg\";\nimport { Icon } from 'leaflet';\n\n// let bikes;\nconst myIcon = new Icon({\n  iconUrl: marker,\n  iconSize: [32, 32]\n})\n\n//ICON\nfunction createIcon(name) {\n  return new Icon({\n    iconUrl: name,\n    iconSize: [41, 47]\n  })\n}\n\nfunction availabilityNum(options) {\n  if (options === 0) {\n    return createIcon(bikemarker0);\n  } else if (options <= 5) {\n    return createIcon(bikemarker1);\n  } else {\n    return createIcon(bikemarker2);\n  }\n}\n\n\nexport default function MapTest() {\n  // ---------way1\n  const JAPAN_COORDINATES = [35.4122, 139.4130];\n  // const TAIPEI_COORDINATES = [25.0223245, 121.499514];\n  //position\n  const [userPosition, setUserPosition] = useState(null);\n  //drag position\n  const [dragposi, setDragposi] = useState(null);\n  //bikes\n  const [getdata, setGetdata] = useState([]);\n\n  const [isLocatingUser, setIsLocatingUser] = useState(true);\n  //\n  const [isDrag, setIsDrag] = useState(false);\n\n  //找單車/車位\n  const [isFindingBikes, setIsFindingBikes] = useState(true);\n\n  const locatingMessage = (\n    <div className=\"overlay\">\n      <span className=\"typography-bold typography-h4\">定位中</span>\n    </div>\n  );\n\n  function handleFindingType() {\n    // setIsFindingBikes((bool) => !bool);\n    setIsFindingBikes(!isFindingBikes);\n  }\n\n  //可複用 取得現在位子，並以此取得bikes data\n  const getPosition = useCallback(async () => {\n    const urlocation = await asyncGetGeolocation();\n    console.log(\"--------yourlocation\" + urlocation)\n    setUserPosition(urlocation);\n \n    const bikes = await getAvailableBikes(urlocation);\n    setGetdata(bikes);\n    console.log(bikes);\n\n    setIsLocatingUser(false);\n\n    //20221114-- setIsDrag(false);\n  }, [])\n\n  //重新定位button\n  const getLocationButton = (\n    <>\n      <button\n        className=\"geolocation\"\n        disabled={isLocatingUser ? true : false}\n        onClick={getPosition}>\n        <img src={geolocactionSvg} alt=\"geolocation icon\" />\n      </button>\n      {/* <h1>{userPosition}</h1> */}\n    </>\n\n  );\n\n\n\n\n  //get dragPosition ==> then get bikes\n  async function getdragPosition() {\n    console.log(\" getdragPosition\");\n    console.log(dragposi);\n    console.log(isDrag);\n\n    if (dragposi === null) {\n      return\n    } else {\n      const bikes = await getAvailableBikes(dragposi);\n      setGetdata(bikes);\n      console.log(bikes);\n    }\n\n    // if (isDrag == false) {\n    //   console.log(userPosition)\n    //   if (dragposi === null) {\n    //     return\n    //   } else {\n    //     bikes = await getAvailableBikes(dragposi);\n    //     setGetdata(bikes);\n    //     console.log(bikes);\n    //   }\n    //   setIsDrag(true);\n    // } else {\n    //   console.log(userPosition)\n    // }\n  }\n\n  // dragend 取得position  更新位子到 dragposi/userPosition\n  function MyComponent() {\n    const map = useMapEvents({\n      dragend: (e) => {\n        console.log(\"mapCenter\", e.target.getCenter());\n        const newposition = e.target.getCenter();\n        const data1 = [newposition.lat, newposition.lng]\n        setDragposi(data1);\n        setUserPosition(data1);\n      }\n    });\n\n\n    // isDrag === true ? setUserPosition(data1) : setUserPosition([25.0223285, 121.4994606]);\n    // return null;\n    return (\n      // <Marker position={isDrag === true ? dragposi : userPosition} icon={myIcon}>\n      <>\n        {/* <DrapMap\n          center={userPosition}\n        /> */}\n        <Marker position={userPosition} icon={myIcon}>\n          <Popup>You are here</Popup>\n        </Marker>\n      </>\n\n    )\n  }\n\n\n  //loading時，就取得現在位子\n  useEffect(() => {\n    getPosition()\n    console.log('getPosition in useEffect');\n  }, [getPosition]);\n\n\n  //loading不用，當drap時才需要用 getPosition()\n  useEffect(() => {\n    //這邊要預防，onload => drap， 然後按重新整理 ，現在重新整理後，又會跑回189，\n    console.log(isLocatingUser)\n    // 74==>yourlocation25.0223446,121.4994686==>setUserPosition(data1)==>181;\n    if (dragposi) {\n      console.log('getdragPosition in useEffect' + dragposi);\n      getdragPosition(dragposi);\n    }\n  }, [dragposi]);\n\n  //========20221114 update\n  // useEffect(() => {\n  //   //這邊要預防，onload => drap， 然後按重新整理 ，現在重新整理後，又會跑回189，\n  //   console.log(\"reflash\"+userPosition)\n  // }, [userPosition]);\n\n  useEffect(() => {\n    console.log(isFindingBikes)\n  }, [isFindingBikes])\n\n  // const BikeMydata = () => {\n  //   console.log(getdata)\n  //   const names = []\n  //   // getdata.forEach((station, index) => { \n  //   //   console.log(station.stationName)\n  //   // })\n  //   getdata.forEach((station, index) => {\n  //     names.push(\n  //       < Marker\n  //         icon={bikeIcon0}\n  //         key={index}\n  //         position={[station.stationPosition.lat, station.stationPosition.lng]}\n  //       >\n  //         {/* <Tooltip direction=\"right\" offset={[0, 0]} opacity={1} permanent>{station.availableRentBikes}</Tooltip> */}\n\n  //         <Popup>{station.stationName}</Popup>\n  //       </Marker>)\n  //   })\n\n  //   return (\n  //     <div className='container'>\n  //       {names}\n  //     </div>\n  //   )\n\n  // }\n  //default : []  render marker\n  function MultipleMarkers() {\n    if (getdata.length == 0) return;\n\n    return getdata.map((station, index) => {\n      // const bikeversion = station.stationName.includes(\"2.0\") ? \"plus\" : \"\"\n      const updateTime = /.*T(\\d*:\\d*)/g.exec(station.srcUpdateTime)[1];\n      return (\n        <Marker key={index}\n          icon={isFindingBikes ? availabilityNum(station.availableRentBikes) : availabilityNum(station.availableReturnBikes)}\n          position={[station.stationPosition.lat, station.stationPosition.lng]}\n        >\n          <Popup className=\"request-popup\">\n            <div className=\"bikeMarkers_popup\">\n              <h3 className=\"typography-bold typography-button\">{station.stationName}</h3>\n              <div className=\"popup_info\">\n                <div className=\"popup_bikes \">\n                  <img src={bicycleGreySvg} alt=\"bicycle icon\" />\n                  <span className=\"quantity typography-bold typography-button\">{station.availableRentBikes}</span>\n                </div>\n                <div className=\"popup_parks\">\n                  <img src={parkingGreySvg} alt=\"bicycle icon\" />\n                  <span className=\"quantity typography-bold typography-button\">{station.availableReturnBikes}</span>\n                </div>\n                <span className=\"update_time typography-medium typography-caption\">{updateTime}更新</span>\n              </div>\n            </div>\n          </Popup>\n\n          <Tooltip direction=\"center\" offset={[0, -2]} opacity={1} permanent>\n            {isFindingBikes ? (station.availableRentBikes) : (station.availableReturnBikes)}\n          </Tooltip>\n\n        </Marker>\n      );\n    });\n  }\n\n  // const MyMarker = () => {\n  //   const points = [\n  //     {\n  //       lat: 33.589803,\n  //       lng: 130.420681,\n  //       title: 'point 1'\n  //     },\n  //     {\n  //       lat: 33.6895,\n  //       lng: 139.69171,\n  //       title: 'point 2'\n  //     }];\n  //   const names = []\n  //   points.forEach(({ lat, lng, title }, index) => {\n  //     names.push(\n  //       < Marker\n  //         key={index}\n  //         position={[lat, lng]}\n  //       // icon={bikeIcon}\n  //       >\n  //         <Popup>{title}</Popup>\n  //       </Marker>)\n  //   })\n\n  //   return (\n  //     <div className='container'>\n  //       {names}\n  //     </div>\n  //   )\n  // }\n\n  //   //   //   //   //   //   //   // \n\n\n  return (\n    <main>\n      {isLocatingUser ? locatingMessage : null}\n\n      {userPosition ?\n        <MapContainer\n          center={userPosition}\n          zoom={16}\n          scrollWheelZoom={true}\n          // id={bike_map}\n          style={{ height: \"calc(100vh - 40px)\" }}\n        >\n          <ChangeCenter\n            center={userPosition}\n          />\n\n          <TileLayer\n            attribution='&copy; <a href=\"https://www.openstreetmap.org/copyright\">OpenStreetMap</a> contributors'\n            url=\"https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png\"\n          />\n\n          {/* drag map */}\n          <MyComponent />\n\n          {/* bikemarker */}\n          <MultipleMarkers />\n\n          <div className=\"find_type_wrapper\">\n            <label htmlFor=\"find_bikes\">\n              <input\n                type=\"radio\"\n                name=\"find_type\"\n                id=\"find_bikes\"\n                checked={isFindingBikes}\n                onChange={() => {\n                  return;\n                }}\n                hidden\n              />\n              <button\n                className=\"find_type typography-bold typography-button\"\n                onClick={handleFindingType}\n              >\n                <div className=\"find_type_img\">\n                  {isFindingBikes ? (\n                    <img src={bicycleWhiteSvg} alt=\"bicycle white icon\" />\n                  ) : (\n                    <img src={bicycleSvg} alt=\"bicycle white icon\" />\n                  )}\n                </div>\n                找單車\n              </button>\n            </label>\n            <label htmlFor=\"find_parks\">\n              <input\n                type=\"radio\"\n                name=\"find_type\"\n                id=\"find_parks\"\n                checked={!isFindingBikes}\n                onChange={() => {\n                  return;\n                }}\n                hidden\n              />\n              <button\n                className=\"find_type typography-bold typography-button\"\n                onClick={handleFindingType}\n              >\n                <div className=\"find_type_img\">\n                  {isFindingBikes ? (\n                    <img src={parkingSvg} alt=\"parking icon\" />\n                  ) : (\n                    <img src={parkingWhiteSvg} alt=\"parking icon\" />\n                  )}\n                </div>\n                找車位\n              </button>\n            </label>\n          </div>\n          {getLocationButton}\n        </MapContainer>\n        : null\n      }\n\n    </main>\n  )\n\n}","// import { useState } from \"react\";\n// // way1 contry \n// import MapArea from \"./components/MapArea\";\n// import CountryButtons from \"./components/CountryButtons\";\n// import \"./styles.css\";a\nimport Header from \"./layout/header\";\nimport Main from \"./layout/main\";\n\nimport React, { useState } from \"react\";\nimport \"./styles.css\";\nimport \"leaflet/dist/leaflet.css\";\n\nimport { MapContainer, TileLayer, Marker, Popup, useMapEvents } from \"react-leaflet\";\n// import marker from './assets/icon-user-position-mobile.svg'\n// import { Icon } from 'leaflet'\n// const myIcon = new Icon({\n//   iconUrl: marker,\n//   iconSize: [32, 32]\n// })\n\n //-----way2\nimport icon from 'leaflet/dist/images/marker-icon.png';\nimport iconShadow from 'leaflet/dist/images/marker-shadow.png';\n\n\nimport MapWrapper from \"./components/MapWrapper\";\nimport MapTest from \"./components/MapTest\";\n\nexport default function App() {\n  const [coordinate, setCoordinate] = useState({\n    latitude: 35.6803997,\n    longitude: 139.7690174,\n    capital: \"Tokyo\"\n  }); \n\n\n  \n  // ---- way2\n  let DefaultIcon = L.icon({\n    iconUrl: icon,\n    shadowUrl: iconShadow\n  });\n\n  L.Marker.prototype.options.icon = DefaultIcon;\n\n\n  const position = [35.6803997, 139.7690174];\n\n  function MyComponent() {\n    const map = useMapEvents({\n      dragend: (e) => {\n        console.log(\"mapCenter\", e.target.getCenter());\n        console.log(\"map bounds\", e.target.getBounds());\n      }\n    });\n    return null;\n  }\n\n\n  return (\n    <div className=\"App\">\n\n      {/* <Header  />\n      <Main/> */}\n\n\n      {/* <MapWrapper /> */}\n      <Header />\n     < MapTest/>  \n      {/* way1 contry  */}\n      {/* <MapArea coordinate={coordinate} />\n      <CountryButtons setCoordinate={setCoordinate} /> */}\n\n      {/* <MapWrapper/> */}\n      \n      {/* ===========drag components================= */}\n      {/* <MapContainer\n        center={position}\n        zoom={13}\n        scrollWheelZoom={false}\n        style={{ height: \"100vh\" }}\n      >\n        <TileLayer\n          attribution='&copy; <a href=\"http://osm.org/copyright\">OpenStreetMap</a> contributors'\n          url=\"https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png\"\n        />\n        <MyComponent />\n        <Marker position={position} >\n          <Popup>\n            A pretty CSS3 popup. <br /> Easily customizable.\n          </Popup>\n        </Marker>\n      </MapContainer> */}\n\n     \n    </div>\n\n\n \n  );\n\n}\n\n// import React from \"react\";\n\n\n// function App() {\n//   return (\n//     <>\n//       <Header />\n//       <Main />\n//     </>\n//   );\n// }\n\n// export default App;\n","import { StrictMode } from \"react\";\nimport { createRoot } from \"react-dom/client\";\nimport App from \"./App\";\n\nimport \"./index.css\";\n\nconst rootElement = document.getElementById(\"root\");\nconst root = createRoot(rootElement);\n\nroot.render(\n  <StrictMode>\n    <App />\n  </StrictMode>\n);\n"],"sourceRoot":""}