(this["webpackJsonpreact-leaflet-map"]=this["webpackJsonpreact-leaflet-map"]||[]).push([[0],{46:function(t,e,n){},47:function(t,e,n){},48:function(t,e,n){},49:function(t,e,n){},50:function(t,e,n){"use strict";n.r(e);var a=n(0),c=n(25),i=(n(66),n(73),n(67),n(68),n(65),n(1)),r=n(69),o=(n(70),n(71),Object(r.a)((function(t){return{styledButton:{width:"200px"}}})),Object(r.a)((function(t){return{styledButton:{width:"200px"}}})),n(46),n(47),n.p+"static/media/logo-light.b2db820f.svg");function s(){return Object(i.jsx)("h1",{className:"logo",children:Object(i.jsx)("a",{target:"_blank",rel:"noreferrer",href:"https://reiracode.github.io/nbike",children:Object(i.jsx)("img",{src:o,alt:"Bikeland"})})})}var l=function(t){return Object(i.jsx)("header",{children:Object(i.jsx)("div",{className:"header_wrapper",children:Object(i.jsx)(s,{})})})},p=n(11),u=n(19),d=n(8),b=(n(48),function(){return new Promise((function(t){if(navigator.geolocation){navigator.geolocation.getCurrentPosition((function(e){t([e.coords.latitude,e.coords.longitude])}),(function(e){switch(e.code){case e.PERMISSION_DENIED:case e.POSITION_UNAVAILABLE:alert("\u8b80\u53d6\u4e0d\u5230\u60a8\u76ee\u524d\u7684\u4f4d\u7f6e");break;case e.TIMEOUT:alert("\u8b80\u53d6\u4f4d\u7f6e\u903e\u6642");break;case e.UNKNOWN_ERROR:alert("Error")}t([35.4122,139.413])}))}}))});function h(t){return f.apply(this,arguments)}function f(){return(f=Object(u.a)(Object(p.a)().mark((function t(e){var n,a,c,i,r,o,s,l,u,b,h,f,g;return Object(p.a)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return console.log(e),t.prev=1,n=Object(d.a)(e,2),a=n[0],c=n[1],i="https://tdx.transportdata.tw/api/basic/v2/Bike/Station/City/Taipei?%24top=30&%24spatialFilter=nearby(".concat(a,",").concat(c,",1000)&%24format=JSON"),"https://tdx.transportdata.tw/api/basic/v2/Bike/Availability/City/Taipei?%24format=JSON",t.next=7,Promise.allSettled([j(i),j("https://tdx.transportdata.tw/api/basic/v2/Bike/Availability/City/Taipei?%24format=JSON")]);case 7:for(r=t.sent,o=[],s=[r[0].value,r[1].value],u=s[1],b=(l=s[0]).map((function(t){return t.StationUID})),h=u.filter((function(t){return b.indexOf(t.StationUID)>-1})),console.log(h),f=0;f<l.length;f++)g={stationId:l[f].StationUID,stationName:l[f].StationName.Zh_tw,stationAddress:l[f].StationAddress.Zh_tw,stationPosition:{lat:l[f].StationPosition.PositionLat,lng:l[f].StationPosition.PositionLon},serviceStatus:h[f].ServiceStatus,availableRentBikes:h[f].AvailableRentBikes,availableReturnBikes:h[f].AvailableReturnBikes,srcUpdateTime:h[f].SrcUpdateTime},o.push(g);return console.log(o),t.abrupt("return",o);case 18:throw t.prev=18,t.t0=t.catch(1),t.t0;case 21:case"end":return t.stop()}}),t,null,[[1,18]])})))).apply(this,arguments)}function j(t){return g.apply(this,arguments)}function g(){return(g=Object(u.a)(Object(p.a)().mark((function t(e){var n,a,c;return Object(p.a)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,y();case 2:return n=t.sent,t.prev=3,t.next=6,fetch(e,{headers:{authorization:"Bearer ".concat(n.access_token)}});case 6:return a=t.sent,t.next=9,a.json();case 9:return c=t.sent,t.abrupt("return",c);case 13:throw t.prev=13,t.t0=t.catch(3),t.t0;case 16:case"end":return t.stop()}}),t,null,[[3,13]])})))).apply(this,arguments)}function y(){return m.apply(this,arguments)}function m(){return(m=Object(u.a)(Object(p.a)().mark((function t(){var e,n;return Object(p.a)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return"https://tdx.transportdata.tw/auth/realms/TDXConnect/protocol/openid-connect/token",e=new URLSearchParams({grant_type:"client_credentials",client_id:"reira.igg-178246c9-c6da-466e",client_secret:"9f16dc51-0a6e-492c-9dd6-278b917d0c67"}).toString(),t.next=5,fetch("https://tdx.transportdata.tw/auth/realms/TDXConnect/protocol/openid-connect/token",{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:e});case 5:return n=t.sent,t.next=8,n.json();case 8:return t.abrupt("return",t.sent);case 9:case"end":return t.stop()}}),t)})))).apply(this,arguments)}var v=n.p+"static/media/icon-user-position-mobile.4af8babd.svg",O=n.p+"static/media/icon-geolocation.7783d3dc.svg",k=n.p+"static/media/icon-bicycle.39345ce0.svg",x=n.p+"static/media/icon-bicycle-grey.7b8cb6aa.svg",w=n.p+"static/media/icon-bicycle-white.0cdc8c9e.svg",_=n.p+"static/media/icon-parking.d41d0ee4.svg",S=n.p+"static/media/icon-parking-grey.84ff3ab7.svg",N=n.p+"static/media/icon-parking-white.95eab66a.svg";function B(t){return 0===t?"none":t<=5?"few":""}var R=n(4),P=n.n(R);function T(t){var e=t.userPosition,n=t.bikesAvailable,c=t.isFindingBikes,r=t.isLocatingUser,o=t.handleLocateUser,s=t.handleFindingType,l=Object(a.useRef)(null),p=Object(a.useRef)(null),u=Object(a.useRef)([]),d=Object(i.jsx)("button",{className:"geolocation",disabled:!!r,onClick:o,children:Object(i.jsx)("img",{src:O,alt:"geolocation icon"})});return Object(a.useEffect)((function(){console.log(l.current),l.current||(l.current=P.a.map("bike_map",{center:e,zoom:15,layers:[P.a.tileLayer("https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",{attribution:'&copy; <a href="http://osm.org/copyright">OpenStreetMap</a> contributors'})]}))}),[e]),Object(a.useEffect)((function(){if(l.current){var t=P.a.icon({iconUrl:v,iconSize:[36,36]});p.current=P.a.marker(e,{icon:t}),p.current&&l.current.removeLayer(p.current),l.current.setView(e,15),p.current.addTo(l.current)}}),[e]),Object(a.useEffect)((function(){var t,e;l.current&&(u.current.forEach((function(t){l.current.removeLayer(t)})),u.current=[],n.forEach((function(n,a){var i=n.stationName.includes("2.0")?"plus":"";t=B(n.availableRentBikes)+" "+i,e=B(n.availableReturnBikes)+" "+i;var r=B(n.availableRentBikes)+" "+i,o=B(n.availableReturnBikes)+" "+i,s="<img src=".concat(x,' alt="bicycle icon" />'),p="<img src=".concat(S,' alt="parking icon" />');u.current[a]=P.a.marker([n.stationPosition.lat,n.stationPosition.lng],{icon:P.a.divIcon({className:"bikeMarker ".concat(c?t:e),html:'<span class="bikeMarker_number typography-bold typography-button">\n            '.concat(c?n.availableRentBikes:n.availableReturnBikes,"</span>")})});var d=/.*T(\d*:\d*)/g.exec(n.srcUpdateTime)[1],b='<div class="bikeMarkers_popup">\n          <h3 class="typography-bold typography-button">'.concat(n.stationName,'</h3>\n          <div class="popup_info">\n              <div class="popup_bikes ').concat(r,'">\n                  ').concat(s,'\n                  <span class="quantity typography-bold typography-button">').concat(n.availableRentBikes,'</span>\n              </div>\n              <div class="popup_parks ').concat(o,'">\n                  ').concat(p,'\n                  <span class="quantity typography-bold typography-button">').concat(n.availableReturnBikes,'</span>\n              </div>\n              <span class="update_time typography-medium typography-caption">').concat(d,"\u66f4\u65b0</span>\n          </div>\n        </div>");u.current[a].bindPopup(b,{className:"popupClass"}),u.current[a].addTo(l.current)})))}),[n,c]),e?Object(i.jsxs)("div",{id:"bike_map",children:[Object(i.jsxs)("div",{className:"find_type_wrapper",children:[Object(i.jsxs)("label",{htmlFor:"find_bikes",children:[Object(i.jsx)("input",{type:"radio",name:"find_type",id:"find_bikes",checked:c,onChange:function(){},hidden:!0}),Object(i.jsxs)("button",{className:"find_type typography-bold typography-button",onClick:s,children:[Object(i.jsx)("div",{className:"find_type_img",children:c?Object(i.jsx)("img",{src:w,alt:"bicycle white icon"}):Object(i.jsx)("img",{src:k,alt:"bicycle white icon"})}),"\u627e\u55ae\u8eca"]})]}),Object(i.jsxs)("label",{htmlFor:"find_parks",children:[Object(i.jsx)("input",{type:"radio",name:"find_type",id:"find_parks",checked:!c,onChange:function(){},hidden:!0}),Object(i.jsxs)("button",{className:"find_type typography-bold typography-button",onClick:s,children:[Object(i.jsx)("div",{className:"find_type_img",children:c?Object(i.jsx)("img",{src:_,alt:"parking icon"}):Object(i.jsx)("img",{src:N,alt:"parking icon"})}),"\u627e\u8eca\u4f4d"]})]})]}),"  ",d]}):null}var E=function(){var t=Object(a.useState)(!1),e=Object(d.a)(t,2),n=e[0],c=e[1],r=Object(a.useState)([]),o=Object(d.a)(r,2),s=o[0],l=o[1],f=Object(a.useState)(!0),j=Object(d.a)(f,2),g=j[0],y=j[1],m=Object(a.useState)(!0),v=Object(d.a)(m,2),O=v[0],k=v[1],x=Object(a.useCallback)(Object(u.a)(Object(p.a)().mark((function t(){var e,n;return Object(p.a)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,b();case 2:return e=t.sent,console.log("yourlocation"+e),c(e),t.next=7,h(e);case 7:n=t.sent,l(n),y(!1);case 10:case"end":return t.stop()}}),t)}))),[]);Object(a.useEffect)((function(){console.log("execute getPosition in useEffect"),x()}),[x]);var w=Object(i.jsx)("div",{className:"overlay",children:Object(i.jsx)("span",{className:"typography-bold typography-h4",children:"\u5b9a\u4f4d\u4e2d"})});return Object(i.jsxs)("main",{children:[g?w:null,n&&Object(i.jsx)(T,{userPosition:n,bikesAvailable:s,isFindingBikes:O,handleLocateUser:x,isLocatingUser:g,handleFindingType:function(){k((function(t){return!t}))}})]})};var U=function(){return Object(i.jsxs)(i.Fragment,{children:[Object(i.jsx)(l,{}),Object(i.jsx)(E,{})]})},C=(n(49),document.getElementById("root"));Object(c.createRoot)(C).render(Object(i.jsx)(a.StrictMode,{children:Object(i.jsx)(U,{})}))}},[[50,1,2]]]);
//# sourceMappingURL=main.4c072725.chunk.js.map