(this["webpackJsonpreact-leaflet-map"]=this["webpackJsonpreact-leaflet-map"]||[]).push([[0],{17:function(t,e,n){},29:function(t,e,n){},31:function(t,e,n){},32:function(t,e,n){},33:function(t,e,n){"use strict";n.r(e);var a=n(0),r=n(18),c=n(3),o=(n(29),n.p,n(1));var i=n(4),s=n(7),l=(n(31),function(){return new Promise((function(t){if(navigator.geolocation){navigator.geolocation.getCurrentPosition((function(e){t([e.coords.latitude,e.coords.longitude])}),(function(e){switch(e.code){case e.PERMISSION_DENIED:case e.POSITION_UNAVAILABLE:alert("\u8b80\u53d6\u4e0d\u5230\u60a8\u76ee\u524d\u7684\u4f4d\u7f6e");break;case e.TIMEOUT:alert("\u8b80\u53d6\u4f4d\u7f6e\u903e\u6642");break;case e.UNKNOWN_ERROR:alert("Error")}t([35.4122,139.413])}))}}))});function u(t){return p.apply(this,arguments)}function p(){return(p=Object(s.a)(Object(i.a)().mark((function t(e){var n,a,r,o,s,l,u,p,d,j,f,h,O,g;return Object(i.a)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(console.log(e),0!=e.length){t.next=4;break}return console.log("0"),t.abrupt("return");case 4:return t.prev=4,n=Object(c.a)(e,2),a=n[0],r=n[1],o="https://tdx.transportdata.tw/api/advanced/v2/Bike/Station/NearBy?%24top=30&%24spatialFilter=nearby(".concat(a,",").concat(r,",1000)&%24format=JSON"),s="https://tdx.transportdata.tw/api/advanced/v2/Bike/Availability/NearBy?%24top=30&%24spatialFilter=nearby(".concat(a,",").concat(r,",1000)&%24format=JSON"),t.next=10,Promise.allSettled([b(o),b(s)]);case 10:for(l=t.sent,u=[],p=[l[0].value,l[1].value],j=p[1],f=(d=p[0]).map((function(t){return t.StationUID})),h=j.filter((function(t){return f.indexOf(t.StationUID)>-1})),O=0;O<d.length;O++)g={stationId:d[O].StationUID,stationName:d[O].StationName.Zh_tw,stationAddress:d[O].StationAddress.Zh_tw,stationPosition:{lat:d[O].StationPosition.PositionLat,lng:d[O].StationPosition.PositionLon},serviceStatus:h[O].ServiceStatus,availableRentBikes:h[O].AvailableRentBikes,availableReturnBikes:h[O].AvailableReturnBikes,srcUpdateTime:h[O].SrcUpdateTime},u.push(g);return t.abrupt("return",u);case 19:throw t.prev=19,t.t0=t.catch(4),t.t0;case 22:case"end":return t.stop()}}),t,null,[[4,19]])})))).apply(this,arguments)}function b(t){return d.apply(this,arguments)}function d(){return(d=Object(s.a)(Object(i.a)().mark((function t(e){var n,a,r;return Object(i.a)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,j();case 2:return n=t.sent,t.prev=3,t.next=6,fetch(e,{headers:{authorization:"Bearer ".concat(n.access_token)}});case 6:return a=t.sent,t.next=9,a.json();case 9:return r=t.sent,t.abrupt("return",r);case 13:throw t.prev=13,t.t0=t.catch(3),t.t0;case 16:case"end":return t.stop()}}),t,null,[[3,13]])})))).apply(this,arguments)}function j(){return f.apply(this,arguments)}function f(){return(f=Object(s.a)(Object(i.a)().mark((function t(){var e,n;return Object(i.a)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return"https://tdx.transportdata.tw/auth/realms/TDXConnect/protocol/openid-connect/token",e=new URLSearchParams({grant_type:"client_credentials",client_id:"reira.igg-178246c9-c6da-466e",client_secret:"9f16dc51-0a6e-492c-9dd6-278b917d0c67"}).toString(),t.next=5,fetch("https://tdx.transportdata.tw/auth/realms/TDXConnect/protocol/openid-connect/token",{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:e});case 5:return n=t.sent,t.next=8,n.json();case 8:return t.abrupt("return",t.sent);case 9:case"end":return t.stop()}}),t)})))).apply(this,arguments)}var h=n.p+"static/media/icon-user-position-mobile.4af8babd.svg",O=(n.p,n.p,n.p+"static/media/icon-bicycle-grey.7b8cb6aa.svg"),g=(n.p,n.p,n.p+"static/media/icon-parking-grey.84ff3ab7.svg"),v=(n.p,n(34)),m=n(35);var x=n(2);n(32),n(13);var y,k=n(20),w=n(21),S=(n(8),n(39)),N=n(36),P=n(37),B=n(38),I=(n(17),n.p+"static/media/icon-bike-marker-grey.d4557c2f.svg"),R=n.p+"static/media/icon-bike-marker-blue.74f2085e.svg",_=n.p+"static/media/icon-bike-marker-purple.3b18ae3f.svg",U=new x.Icon({iconUrl:h,iconSize:[32,32]});E(I),E(R),E(_);function E(t){return new x.Icon({iconUrl:t,iconSize:[41,47]})}function T(){var t=Object(a.useState)([25.0223245,121.499514]),e=Object(c.a)(t,2),n=e[0],r=e[1],p=Object(a.useState)(null),b=Object(c.a)(p,2),d=b[0],j=b[1],f=Object(a.useState)([]),h=Object(c.a)(f,2),x=h[0],k=h[1],w=Object(a.useCallback)(Object(s.a)(Object(i.a)().mark((function t(){var e,n;return Object(i.a)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,l();case 2:return e=t.sent,console.log("yourlocation"+e),r(e),t.next=7,u(e);case 7:n=t.sent,k(n),console.log(n);case 10:case"end":return t.stop()}}),t)}))),[]);function T(){return(T=Object(s.a)(Object(i.a)().mark((function t(){return Object(i.a)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(console.log(d),null!==d){t.next=5;break}return t.abrupt("return");case 5:return t.next=7,u(d);case 7:y=t.sent,k(y),console.log(y);case 10:case"end":return t.stop()}}),t)})))).apply(this,arguments)}function A(){Object(v.a)({dragend:function(t){console.log("mapCenter",t.target.getCenter());var e=t.target.getCenter(),n=[e.lat,e.lng];j(n),r(n)}});return null===d?null:Object(o.jsx)(N.a,{position:d,children:Object(o.jsx)(P.a,{children:"You are here"})})}function C(){if(console.log(x),0!=x.length)return x.map((function(t,e){var n;t.stationName.includes("2.0");return Object(o.jsxs)(N.a,{icon:(n=t.availableRentBikes,E(0===n?I:n<=5?R:_)),position:[t.stationPosition.lat,t.stationPosition.lng],children:[Object(o.jsx)(P.a,{className:"request-popup",children:Object(o.jsxs)("div",{className:"bikeMarkers_popup",children:[Object(o.jsx)("h3",{className:"typography-bold typography-button",children:t.stationName}),Object(o.jsxs)("div",{className:"popup_info",children:[Object(o.jsxs)("div",{className:"popup_bikes ",children:[Object(o.jsx)("img",{src:O,alt:"bicycle icon"}),Object(o.jsx)("span",{className:"quantity typography-bold typography-button",children:t.availableRentBikes})]}),Object(o.jsxs)("div",{className:"popup_parks  ",children:[Object(o.jsx)("img",{src:g,alt:"bicycle icon"}),Object(o.jsx)("span",{className:"quantity typography-bold typography-button",children:t.availableReturnBikes})]})]})]})}),Object(o.jsx)(B.a,{direction:"center",offset:[0,-4],opacity:1,permanent:!0,children:t.availableRentBikes})]},e)}))}return Object(a.useEffect)((function(){w(),console.log("getPosition in useEffect")}),[w]),Object(a.useEffect)((function(){d&&(console.log("getdragPosition in useEffect"+d),function(){T.apply(this,arguments)}(d))}),[d]),n.length?Object(o.jsxs)(m.a,{center:n,zoom:16,scrollWheelZoom:!0,style:{height:"100vh"},children:[Object(o.jsx)(S.a,{attribution:'\xa9 <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors',url:"https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png"}),Object(o.jsx)(A,{}),Object(o.jsx)(C,{}),Object(o.jsx)(N.a,{position:n,icon:U,children:Object(o.jsx)(P.a,{children:"You're Here!"})})]}):null}function A(){var t=Object(a.useState)({latitude:35.6803997,longitude:139.7690174,capital:"Tokyo"}),e=Object(c.a)(t,2),n=(e[0],e[1],L.icon({iconUrl:k.a,shadowUrl:w.a}));L.Marker.prototype.options.icon=n;return Object(o.jsx)("div",{className:"App",children:Object(o.jsx)(T,{})})}var C=document.getElementById("root");Object(r.createRoot)(C).render(Object(o.jsx)(a.StrictMode,{children:Object(o.jsx)(A,{})}))}},[[33,1,2]]]);
//# sourceMappingURL=main.b2f5fba0.chunk.js.map