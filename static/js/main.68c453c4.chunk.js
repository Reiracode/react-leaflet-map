(this["webpackJsonpreact-leaflet-map"]=this["webpackJsonpreact-leaflet-map"]||[]).push([[0],{16:function(e,t,n){},26:function(e,t,n){},29:function(e,t,n){},30:function(e,t,n){},31:function(e,t,n){"use strict";n.r(t);var a=n(1),c=n(17),i=(n(26),n.p+"static/media/logo-light.b2db820f.svg"),r=n(0);function s(){return Object(r.jsx)("h1",{className:"logo",children:Object(r.jsx)("a",{target:"_blank",rel:"noreferrer",href:"https://reiracode.github.io/react-leaflet-map",children:Object(r.jsx)("img",{src:i,alt:"Bikeland"})})})}var o=function(e){return Object(r.jsx)("header",{children:Object(r.jsx)("div",{className:"header_wrapper",children:Object(r.jsx)(s,{})})})},l=n(5),p=n(7),u=n(4),d=n(2),b=n(32),j=n(33),h=n(34),g=function(){var e=[35.4122,139.413];return new Promise((function(t){if(navigator.geolocation){navigator.geolocation.getCurrentPosition((function(e){t([e.coords.latitude,e.coords.longitude])}),(function(n){switch(n.code){case n.PERMISSION_DENIED:case n.POSITION_UNAVAILABLE:alert("\u8b80\u53d6\u4e0d\u5230\u60a8\u76ee\u524d\u7684\u4f4d\u7f6e");break;case n.TIMEOUT:alert("\u8b80\u53d6\u4f4d\u7f6e\u903e\u6642");break;case n.UNKNOWN_ERROR:alert("Error")}t(e)}))}}))};function f(e){return O.apply(this,arguments)}function O(){return(O=Object(p.a)(Object(l.a)().mark((function e(t){var n,a,c,i,r,s,o,p,d,b,j,h,g,f;return Object(l.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(0!=t.length){e.next=3;break}return console.log("0"),e.abrupt("return");case 3:return e.prev=3,n=Object(u.a)(t,2),a=n[0],c=n[1],i="https://tdx.transportdata.tw/api/advanced/v2/Bike/Station/NearBy?%24top=30&%24spatialFilter=nearby(".concat(a,",").concat(c,",1000)&%24format=JSON"),r="https://tdx.transportdata.tw/api/advanced/v2/Bike/Availability/NearBy?%24top=30&%24spatialFilter=nearby(".concat(a,",").concat(c,",1000)&%24format=JSON"),e.next=9,Promise.allSettled([m(i),m(r)]);case 9:for(s=e.sent,o=[],p=[s[0].value,s[1].value],b=p[1],j=(d=p[0]).map((function(e){return e.StationUID})),h=b.filter((function(e){return j.indexOf(e.StationUID)>-1})),g=0;g<d.length;g++)f={stationId:d[g].StationUID,stationName:d[g].StationName.Zh_tw,stationAddress:d[g].StationAddress.Zh_tw,stationPosition:{lat:d[g].StationPosition.PositionLat,lng:d[g].StationPosition.PositionLon},serviceStatus:h[g].ServiceStatus,availableRentBikes:h[g].AvailableRentBikes,availableReturnBikes:h[g].AvailableReturnBikes,srcUpdateTime:h[g].SrcUpdateTime},o.push(f);return e.abrupt("return",o);case 18:throw e.prev=18,e.t0=e.catch(3),e.t0;case 21:case"end":return e.stop()}}),e,null,[[3,18]])})))).apply(this,arguments)}function m(e){return x.apply(this,arguments)}function x(){return(x=Object(p.a)(Object(l.a)().mark((function e(t){var n,a,c;return Object(l.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,v();case 2:return n=e.sent,e.prev=3,e.next=6,fetch(t,{headers:{authorization:"Bearer ".concat(n.access_token)}});case 6:return a=e.sent,e.next=9,a.json();case 9:return c=e.sent,e.abrupt("return",c);case 13:throw e.prev=13,e.t0=e.catch(3),e.t0;case 16:case"end":return e.stop()}}),e,null,[[3,13]])})))).apply(this,arguments)}function v(){return y.apply(this,arguments)}function y(){return(y=Object(p.a)(Object(l.a)().mark((function e(){var t,n;return Object(l.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return"https://tdx.transportdata.tw/auth/realms/TDXConnect/protocol/openid-connect/token",t=new URLSearchParams({grant_type:"client_credentials",client_id:"reira.igg-178246c9-c6da-466e",client_secret:"9f16dc51-0a6e-492c-9dd6-278b917d0c67"}).toString(),e.next=5,fetch("https://tdx.transportdata.tw/auth/realms/TDXConnect/protocol/openid-connect/token",{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:t});case 5:return n=e.sent,e.next=8,n.json();case 8:return e.abrupt("return",e.sent);case 9:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var k=n(36),w=n(37),N=function(e){return Object(b.a)().setView(e.center),null},_=n.p+"static/media/icon-geolocation.7783d3dc.svg",S=function(e){var t=e.onMoveTo,n=e.isLocatingUser;return Object(r.jsx)("button",{className:"geolocation",onClick:t,disabled:!!n,children:Object(r.jsx)("img",{src:_,alt:"geolocation icon"})})},B=n.p+"static/media/icon-bicycle-white.0cdc8c9e.svg",P=n.p+"static/media/icon-parking-white.95eab66a.svg",R=n.p+"static/media/icon-bicycle.39345ce0.svg",U=n.p+"static/media/icon-parking.d41d0ee4.svg",T=function(e){var t=e.isFindingBikes,n=e.handleFindingType;return Object(r.jsxs)("div",{className:"find_type_wrapper",children:[Object(r.jsxs)("label",{htmlFor:"find_bikes",children:[Object(r.jsx)("input",{type:"radio",name:"find_type",id:"find_bikes",checked:t,onChange:function(){},hidden:!0}),Object(r.jsxs)("button",{className:"find_type typography-bold typography-button",onClick:n,children:[Object(r.jsx)("div",{className:"find_type_img",children:t?Object(r.jsx)("img",{src:B,alt:"bicycle white icon"}):Object(r.jsx)("img",{src:R,alt:"bicycle white icon"})}),"\u627e\u55ae\u8eca"]})]}),Object(r.jsxs)("label",{htmlFor:"find_parks",children:[Object(r.jsx)("input",{type:"radio",name:"find_type",id:"find_parks",checked:!t,onChange:function(){},hidden:!0}),Object(r.jsxs)("button",{className:"find_type typography-bold typography-button",onClick:n,children:[Object(r.jsx)("div",{className:"find_type_img",children:t?Object(r.jsx)("img",{src:U,alt:"parking icon"}):Object(r.jsx)("img",{src:P,alt:"parking icon"})}),"\u627e\u8eca\u4f4d"]})]})]})},I=n(35),C=n.p+"static/media/icon-bike-marker-grey.d4557c2f.svg",E=n.p+"static/media/icon-bike-marker-blue.74f2085e.svg",F=n.p+"static/media/icon-bike-marker-purple.3b18ae3f.svg";function A(e){return new d.Icon({iconUrl:e,iconSize:[41,47]})}var D=n.p+"static/media/icon-bicycle-grey.7b8cb6aa.svg",L=n.p+"static/media/icon-parking-grey.84ff3ab7.svg",M=function(e){var t=e.getdata,n=e.isFindingBikes;if(0!=t.length)return t.map((function(e,t){var a,c=/.*T(\d*:\d*)/g.exec(e.srcUpdateTime)[1];return Object(r.jsxs)(j.a,{icon:(a=n?e.availableRentBikes:e.availableReturnBikes,A(0==a?C:a<=5?E:F)),position:[e.stationPosition.lat,e.stationPosition.lng],children:[Object(r.jsx)(h.a,{className:"request-popup",children:Object(r.jsxs)("div",{className:"bikeMarkers_popup",children:[Object(r.jsx)("h3",{className:"typography-bold typography-button",children:e.stationName}),Object(r.jsxs)("div",{className:"popup_info",children:[Object(r.jsxs)("div",{className:"popup_bikes ",children:[Object(r.jsx)("img",{src:D,alt:"bicycle icon"}),Object(r.jsx)("span",{className:"quantity typography-bold typography-button",children:e.availableRentBikes})]}),Object(r.jsxs)("div",{className:"popup_parks",children:[Object(r.jsx)("img",{src:L,alt:"bicycle icon"}),Object(r.jsx)("span",{className:"quantity typography-bold typography-button",children:e.availableReturnBikes})]}),Object(r.jsxs)("span",{className:"update_time typography-medium typography-caption",children:[c,"\u66f4\u65b0"]})]})]})}),Object(r.jsx)(I.a,{direction:"center",offset:[0,-2],opacity:1,permanent:!0,children:n?Object(r.jsx)("span",{className:"test1",children:e.availableRentBikes}):Object(r.jsx)("span",{className:"test2",children:e.availableReturnBikes})})]},t)}))};function z(e){var t=e.userPosition,n=e.getdata,c=e.DragMap,i=e.getPosition,s=e.isLocatingUser,o=Object(a.useState)(!0),l=Object(u.a)(o,2),p=l[0],d=l[1];return Object(r.jsx)("main",{children:t?Object(r.jsxs)(k.a,{center:t,zoom:16,scrollWheelZoom:!0,style:{height:"calc(100vh - 40px)"},children:[Object(r.jsx)(N,{center:t}),Object(r.jsx)(w.a,{attribution:'\xa9 <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors',url:"https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png"}),Object(r.jsx)(c,{}),Object(r.jsx)(M,{getdata:n,isFindingBikes:p}),Object(r.jsx)(T,{isFindingBikes:p,handleFindingType:function(){d(!p)}}),Object(r.jsx)(S,{onMoveTo:i,isLocatingUser:s})]}):null})}var J=n.p+"static/media/icon-user-position-mobile.4af8babd.svg",q=(n(28),n(16),n(29),new d.Icon({iconUrl:J,iconSize:[32,32]}));function Z(){var e=Object(a.useState)(null),t=Object(u.a)(e,2),n=t[0],c=t[1],i=Object(a.useState)(null),s=Object(u.a)(i,2),o=s[0],d=s[1],O=Object(a.useState)([]),m=Object(u.a)(O,2),x=m[0],v=m[1],y=Object(a.useState)(!0),k=Object(u.a)(y,2),w=k[0],N=k[1],_=Object(r.jsx)("div",{className:"overlay",children:Object(r.jsx)("span",{className:"typography-bold typography-h4",children:"\u5b9a\u4f4d\u4e2d"})}),S=Object(a.useCallback)(Object(p.a)(Object(l.a)().mark((function e(){var t,n;return Object(l.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,g();case 2:return t=e.sent,console.log("--------yourlocation"+t),c(t),e.next=7,f(t);case 7:n=e.sent,v(n),N(!1);case 10:case"end":return e.stop()}}),e)}))),[]);function B(){return(B=Object(p.a)(Object(l.a)().mark((function e(){var t;return Object(l.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(null!==o){e.next=4;break}return e.abrupt("return");case 4:return e.next=6,f(o);case 6:t=e.sent,v(t),console.log(t);case 9:case"end":return e.stop()}}),e)})))).apply(this,arguments)}return Object(a.useEffect)((function(){S(),console.log("getPosition in useEffect")}),[S]),Object(a.useEffect)((function(){o&&(console.log("getdragPosition in useEffect"+o),function(){B.apply(this,arguments)}(o))}),[o]),Object(r.jsxs)("main",{children:[w?_:null,n?Object(r.jsx)(z,{userPosition:n,getdata:x,DragMap:function(){return Object(b.b)({dragend:function(e){console.log("mapCenter",e.target.getCenter());var t=e.target.getCenter(),n=[t.lat,t.lng];d(n),c(n)}}),Object(r.jsx)(j.a,{position:n,icon:q,children:Object(r.jsx)(h.a,{children:"You are here"})})},getPosition:S,isLocatingUser:w}):null]})}n(30);function V(){return Object(r.jsxs)("div",{className:"App",children:[Object(r.jsx)(o,{}),Object(r.jsx)(Z,{})]})}var W=document.getElementById("root");Object(c.createRoot)(W).render(Object(r.jsx)(a.StrictMode,{children:Object(r.jsx)(V,{})}))}},[[31,1,2]]]);
//# sourceMappingURL=main.68c453c4.chunk.js.map